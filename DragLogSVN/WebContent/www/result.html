<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
<link rel="stylesheet" href="font/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="css/lineconStyle.css">
<link rel="stylesheet" href="css/common_font.css">
<link rel="stylesheet" href="css/result.css">

<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/jquery.touchSwipe.js"></script>
<script type="text/javascript" src="js/jquery.drawDoughnutChart.js"></script>
<script type="text/javascript" src="js/sha1.js"></script>
<script type="text/javascript" src="js/result.js"></script>
<title>Result</title>
<style type="text/css">
#facebook { width: 100px; height: 50px; margin-left: 50px; font-size: 130%;}

#share { position: absolute; bottom: 50px; right: 10px; width: 50px; height: 50px; z-index: 9; }
#shareDiv { background: #ccc; 
position: absolute; bottom: 50px; width: 100%; 
text-align: center; }
#shareDiv img { width: 50px; height: 50px; margin: 0 10px; }

</style>
</head>

<body>
<div class="header" data-role="header"><a class="mainLink"onclick="location.href='main.html';">&lt;</a><p>LOG Result</p></div>
<div id="date">
	<span class="left">&lt;</span><span class="right">&gt;</span>
	<p id="stDt"></p>
</div>

<section id="layout">
<div id="rtScroll">
	<p id="description"></p>
	<div id="resultList"></div>
	<div id="chart"></div>
</div>
</section>

<div class="random" onclick="location.href='other_people.html';">?</div>
<div id="type">CHART</div>

<button id="facebook">Facebook</button>
<img id="share" src="icon/share.png">

<div id="shareDiv">
	<img id="facebookIcon" src="icon/katalk.png">
	<img id="facebookIcon" src="icon/katalk.png">
	<img id="facebookIcon" src="icon/katalk.png">
	<img id="facebookIcon" src="icon/katalk.png">
	<img id="facebookIcon" src="icon/katalk.png">
	
</div>

<div class="range listNavi">
	<div id="day" class="dateNavi">1D</div>
 	<div id="week" class="weekNavi">1W</div>
	<div id="month" class="monthNavi">1M</div>
</div>

</body>

<script type="text/javascript">

$(function(){
	$('#submit').on('click', function(){
		var sns = $('#select option:selected').val();
		var txt = 'My Log';
		sendSns(sns, url, txt);
	});
	
	
	$('#facebook').on('click', function(){
		facebook();
	});

});

function facebook() {
	if (result.length != 0) {
		// 유니크 Parameter 만들기
		var sns = 'facebook';
		var url = 'http://14.32.66.98:1110/sns/snsResult.jsp?p=';
		var txt = 'semiLog My Result';
		
		var urlParam = SHA1(userNo + new Date());
		var period = $('#stDt').text();
		
		// 결과용 데이터 node.js 로 전송
		$.post('http://14.32.66.98:1111/snsShare', {urlParam: urlParam, scope: scope, period: period, result: result})
		.done(function(data) {
			console.log(data);
			url += urlParam;
			console.log(url);
			sendSns(sns, url, txt);
		});
		
	}
}

function sendSns(sns, url, txt)
{
    var o;
    var _url = encodeURIComponent(url);
    var _txt = encodeURIComponent(txt);
    var _br  = encodeURIComponent('\r\n');
 
    switch(sns)
    {
        case 'facebook':
            o = {
                method:'popup',
                url:'http://www.facebook.com/sharer/sharer.php?u=' + _url
            };
            break;
 
        case 'twitter':
            o = {
                method:'popup',
                url:'http://twitter.com/intent/tweet?text=' + _txt + '&url=' + _url
            };
            break;
 
        case 'me2day':
            o = {
                method:'popup',
                url:'http://me2day.net/posts/new?new_post[body]=' + _txt + _br + _url + '&new_post[tags]=semiLog'
            };
            break;
 
        case 'kakaotalk':
            o = {
                method:'web2app',
                /* param:'sendurl?msg=' + _txt + '&url=' + _url + '&type=link&apiver=2.0.1&appver=2.0&appid=dev.epiloum.net&appname=' + encodeURIComponent('semiLog'), */
                param:'sendurl?msg=' + _txt + '&url=' + _url + '&type=link&apiver=2.0.1&appver=2.0&appid=dev.epiloum.net&appname=' + encodeURIComponent('semiLog'), 
                a_store:'itms-apps://itunes.apple.com/app/id362057947?mt=8',
                g_store:'market://details?id=com.kakao.talk',
                a_proto:'kakaolink://',
                g_proto:'scheme=kakaolink;package=com.kakao.talk'
            };
            break;
 
        case 'kakaostory':
            o = {
                method:'web2app',
                /* param:'posting?post=' + _txt + _br + _url + '&apiver=1.0&appver=2.0&appid=dev.epiloum.net&appname=' + encodeURIComponent('semiLog'), */
                param:'posting?post=' + _txt + _br + _url + '&apiver=1.0&appname=' + encodeURIComponent('semiLog'),
                a_store:'itms-apps://itunes.apple.com/app/id486244601?mt=8',
                g_store:'market://details?id=com.kakao.story',
                a_proto:'storylink://',
                g_proto:'scheme=kakaolink;package=com.kakao.story'
            };
            break;
 
        case 'band':
            o = {
                method:'web2app',
                param:'create/post?text=' + _txt + _br + _url,
                a_store:'itms-apps://itunes.apple.com/app/id542613198?mt=8',
                g_store:'market://details?id=com.nhn.android.band',
                a_proto:'bandapp://',
                g_proto:'scheme=bandapp;package=com.nhn.android.band'
            };
            break;
 
        default:
            alert('지원하지 않는 SNS입니다.');
            return false;
    }
 
    switch(o.method)
    {
        case 'popup':
            window.open(o.url);
            break;
 
        case 'web2app':
            if(navigator.userAgent.match(/android/i))
            {
                // Android
                setTimeout(function(){ location.href = 'intent://' + o.param + '#Intent;' + o.g_proto + ';end'}, 100);
            }
            else if(navigator.userAgent.match(/(iphone)|(ipod)|(ipad)/i))
            {
                // Apple
                setTimeout(function(){ location.href = o.a_store; }, 200);          
                setTimeout(function(){ location.href = o.a_proto + o.param }, 100);
            }
            else
            {
                alert('이 기능은 모바일에서만 사용할 수 있습니다.');
            }
            break;
    }
}
</script>
</html>